# 慧停车项目

[TOC]

## 项目简介

​        随着经济的快速发展，汽车总量迅速上升，与此同时，众多城市，特别是一、二线大城市，在一些大型商场或办公楼等车流量大的地方常常出现高峰期车位难找、停车难停等问题。

​        针对传统停车场存在的供需不平衡等问题，本项目旨在开发一套智能停车系统，以**预约车位**为主打功能，帮助用户根据行程提前查询、预约“锁定”车位，操作简单的同时省去现场找车位的麻烦和不确定性，省心省时；同时本项目还以**车位查询、自动扣费**等为辅助功能，帮助用户在大型停车场中快速找到自己的车位，并自动扣费离场。

## 现实背景

在项目前期准备过程中，我们综合目前社会的现状及国内现有相关项目的弊端进行了总结，即

1. 我国民用汽车拥有量一直在不断增长。下表为2014-2018年部分地区民用汽车拥有量

| 年份  地区 | 2014年  | 2015年  | 2016年  | 2017年  | 2018年  |
| ---------- | ------- | ------- | ------- | ------- | ------- |
| 北京市     | 530.83  | 533.81  | 547.44  | 563.1   | 574.04  |
| 上海市     | 255.03  | 282.23  | 322.87  | 360.96  | 393.37  |
| 广东省     | 1331.84 | 1471.4  | 1674.64 | 1894.22 | 2116.28 |
| 江苏省     | 1095.45 | 1240.91 | 1427.91 | 1612.82 | 1776.57 |
| 山西省     | 424.36  | 468.97  | 526.39  | 591.98  | 652.15  |
| 吉林省     | 284.57  | 313.74  | 352.93  | 387.15  | 421.92  |
| 广西省     | 316.53  | 363.82  | 424.90  | 502.13  | 588.42  |
| 陕西省     | 384.88  | 438.12  | 491.23  | 549.51  | 616.80  |

2. 特别是在一般大型商场、医院的地下停车场的面积都比较大而且客流量也大时，对于每辆汽车来说，将会面临以下难题：

   1）有急事去商场但找不到空的停车位，在停车场中来回绕圈找车位的同时人们会增加不耐烦的情绪也浪费了时间；

   2）从商场下来停车场之后人们往往迷失在大停车场中找不到自己的车在哪里。

3. 而目前市场上现有的软件不多，并且主要以路边、小区等零散的车位为主，十分不方便的同时还有找到预约车位不便利的缺点。

|                        | Ai停车                                             | 宜停车                                         | 好停车                                   |
| ---------------------- | -------------------------------------------------- | ---------------------------------------------- | ---------------------------------------- |
| 下载量（华为应用市场） | 暂无                                               | 285万次                                        | 54万次                                   |
| 评分（华为应用市场）   | 暂无                                               | 1.5（68人评分）                                | 1.7（20人评分）                          |
| 经营范围               | 一线城市商场的地下停车场                           | 以深圳市为主的各大城市                         | 全国各大城市                             |
| 功能                   | 停车场定位  搜索车位  寻找车位  预约停车  出场缴费 | 路边停车  预约停车                             | 搜索车位  停车缴费  车位共享             |
| 精准查找               | 精准到商场地下车位                                 | 可以精准到车位但要事先知道车位号，实际中不可行 | 精准到小区停车位，受时间空间限制大       |
| 实用性                 | 强                                                 | 不太强                                         | 不太强                                   |
| 便利性                 | 非常方便                                           | 不方便                                         | 不方便                                   |
| 针对性                 | 针对性高                                           | 针对性不高                                     | 针对性不高                               |
| 存在问题               | 市场不兼容  初期无法迅速扩大市场                   | 资源分散化  定位地图有故障                     | 一个车牌只能绑定一个手机号  路边停车收费 |

 

我们的Ai停车项目也在此背景下应运而生，专注于缓解用户停车难的问题。

1. 本项目主打功能为**预约停车**，可以帮助用户根据行程提前查询、预约“锁定”车位。

2. 同时本项目还以**车位查询、自动扣费** 等为辅助功能，帮助用户在大型停车场中快速找到自己的车位，并自动扣费离场。

 



## 前端开发

> 微信小程序开发

### 技术选型

> 由于市面上的微信小程序开发框架并不是十分的完善，在这里我们采用原生开发
>
> 开发语言：js、wxss、wxml等
>
> 代码数量：1万行左右
>
> 第三方接口：腾讯地图导航API、和风天气API、网易云音乐API

### 页面结构

1. assessment 停车场用户评论页面
2. checkParking
3. confirm 确认订单页面
4. home 主页面
5. index
6. login 登录界面
7. mv 网易云视频界面
8. order 订单界面
9. orderDetail 订单详情界面
10. packing 停车场信息界面
11. personal 个人中心界面
12. play  娱乐应用界面
13. play_time 
14. search  搜索界面
15. showAssess 展示用户评论界面
16. songList 网易云音乐列表界面
17. userInfo 用户信息界面
18. weather  城市天气界面

具体页面展示请见文件夹中的页面展示ppt或展示视频



## 后端开发

> 1. MEVN架构
>
> 2. 分布式架构

本地测试（简单测试接口）

```shell
1. 安装node环境
2. 打开命令行工具，切换目录路径到node文件夹
3. 输入命令 node start
```



### 后端架构

##### 1.后端架构图：

<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200627441.png" alt="image-20210529200627441" style="zoom: 80%;" />



**2.**   **架构说明：**

 后端预计在经过几次开发迭代之后，在不断增长的需求驱动之下，最终会将应用进行拆分，变成微服务架构下的分布式应用，各个服务独立打包部署，并且通过冗余保证可用性，同时具备线性伸缩的能力。

 

**3.**  **请求处理流程**

1. 请求最先经过反向代理服务器，目的是为下一层的网关服务集群负载均衡，所以只做请求转发，不做其他处理，不会有太高负载，虽然是入口处，但不会成为性能瓶颈。

2. 下面到达网关服务集群，这一层会做鉴权，并且根据请求路径的url匹配一个服务，然后到注册中心去拉取该服务的可用地址列表，在负载均衡之后路由服务到选中节点。

3.  服务层由多个垂直拆分后的微服务组成，是真正的业务处理层。服务间通过网络进行通讯，每个服务上下线都会去注册中心注册，通过注册中心实现服务的动态发现。同时这些服务都是用docker进行集群部署，足够便捷和快速，而且服务之间因为拆分的颗粒度足够细，所以保持了较低的耦合，并且还通过消息队列进一步削峰和解耦，每个服务都可以独立打包上线。还有一些其他附加功能，比如服务的监控中心、配置中心、日志分析系统等都是保障服务层高可用的重要部件。

4. 数据库层很容易是性能瓶颈，因为Ai停车作为一款互联网应用，所以必须具有较高的性能，我们选定了Percona Server（关系型数据库，存储结构化、同时可靠性要求高的数据）、MongoDB（半结构化数据库，低概率丢失数据，但性能较高，用来存储用户订阅的车锁等数据）、Redis（K-V性数据库，主要用来作为高性能缓存，避免和服务的JVM共用内存）、ElasticSearch（搜索引擎，用来做存储海量日志，后期车锁增多，也可能用来索引车锁信息）、OSS（分布式文件存储，存储用户上传的文件，比如头像等）。

5. 运行环境我们选择阿里云服务器，使用Centos系统镜像，采用虚拟化技术Docker最大程度利用资源。



#### 后端简要介绍

领域驱动模型：车位（停车场信息、车位坐标、车锁）、商户（分为：停车场、广告商户）、用户（权限角色、车位的关联、订单关联）

领域之间不建立外键的完整性约束，为以后需要服务拆分时可以按照领域模型拆分



<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200717931.png" alt="image-20210529200717931" style="zoom:67%;" />

接口文档的设计（部分截图）

以领域分大类，以领域的独立对象再分小类，目前设计了70多个接口

下述截图的用户这个领域的鉴权部分的接口，其中1.*、登录注册 2.*、授权鉴权

<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200750078.png" alt="image-20210529200750078" style="zoom:67%;" />

软件环境搭建

​    服务器上以 Docker 的形式，安装运行了 Percona、Redis、RocketMQ、Nginx等服务，并且通过本地代码远程连接已经没有问题。

​                  ![image-20210529200807114](C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200807114.png)

集成环境搭建

使用 Jenkins持续集成，同样使用Docker 作为运行环境，通过 GitHub的Web Hock 触发 Jenkins 执行构建脚本，构建脚本又会调用 Docker 命令根据编写的 Dockerfile 构建镜像然后运行，所以只用 IDEA集成Git，每次 Commit 后可以自动集成与打包构建。

 <img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200826444.png" alt="image-20210529200826444" style="zoom:67%;" />

### 硬件设计

**二、智能车锁。**

##### 1、智能车位门禁的装置及其安放位置如图所示。



![image-20210529200558701](C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200558701.png)

![img](file:///C:/Users/MR.X/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)





黄色圆环：布置含有声波测距模块的智能车位门禁竖立杆

无色圆环：布置普通智能车位门禁竖立杆

-----：可升降连线位置

该装置由车位与车位之间的竖立杆以及杆与杆之间的发光连线组成。

当该车位没有被预定并且车位内没有车辆停放时，杆与杆之间的连线收缩至位于地面的水平槽内，并呈现出绿色，车辆可以自由进出。当该车位被预定时，杆与杆之间的连线被拉起，并呈现为黄色，此时由于连线的存在与阻挡，车辆无法自由进出。当车位那地方有车辆时，杆与杆之间的连线呈现为红色。

竖立杆位于车位两侧，不影响车辆正常进出。杆与杆之间的连线位于车位的一个侧面上，当连线放在地上时，车辆可以从连线上自由进出。当连线被拉起时，车辆受到阻挡，无法自由进出，起到门禁效果。

在门禁装置图中，竖立杆与发光连线交替存在，一个发光连线连接着两个竖立杆，每个竖立杆也连接着两个发光连线。根据停车场的具体车位位置及周边环境，竖立杆有多种型号可供选择，一个竖立杆所连接的连线可以有一个或者两个，两侧连线间所成的角度可以为90°或180°。为节省成本，当一个竖立杆的两侧的两个竖立杆上都安装有声波测距装置时，这个竖立杆的顶端可以不用安装后续装置，因为两侧已经被有效覆盖。

 

##### 2、竖立杆

1. 整体图

<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200405850.png" alt="image-20210529200405850" style="zoom: 67%;" />



竖立杆的两侧有槽，内部有可滑动的装置，通过电机牵引钢丝拉动两个杆之间的连线上下移动。

 

2. 竖立杆顶部图

<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200416806.png" alt="image-20210529200416806" style="zoom: 67%;" />

竖立杆的顶部有4个超声波测距模块，分别于两侧的连线乘45°角。其中两个超声波测距模块对准两侧的停车位，另外两个超声波测距模块对准外侧的车道。可以判断为车位内停用车辆，或者有车辆将停靠在附近的停车位中。

竖立杆的顶端也装有发光二极管指示灯，用来表示该装置的状态是否正常，连线上有红色和绿色两种发光二极管，当红色和绿色同时发亮时，呈现出黄色（RGB混色原理）。

每个竖立杆的内部有WiFi模块，可以借助于局域网，通过互联网与用户的手机App进行交互。同时还可以基于WiFi对这些设备进行远程控制以及数据传输。

连线的内部可以内置电线，通过连线进行电能输送，也可以通过连线内部的相关线路进行信号传输。从而该装置不需要内置电池。

 

3. 竖立杆底部图

<img src="C:\Users\MR.X\AppData\Roaming\Typora\typora-user-images\image-20210529200448726.png" alt="image-20210529200448726" style="zoom: 67%;" />

##### 3、终端设备

1. 方案：Raspberry Pi Zero W、直流减速电机、LED、超声波测距传感器、路由器

2. 数据处理流程：

   （1） 远程控制：用户通过手机App发送请求到云服务器，云服务器将上锁/开锁的指令返回响应，路由器接收到指令后，通过局域网转发给对应车锁，车锁启动电机升降发光连线，实现车锁的远程控制。

   （2） 状态反馈：车位默认是无人占用的状态，当车位状态改变的时候，车锁通过局域网发送一个信号到路由器，路由器再转发给云服务器。

3. 车位检测：

   通过竖立杆上的超声波测距传感器检测杆到实体的距离，当距离小于一个阈值一定时间的时候系统会认为车位已被占用；反之，当距离大于一个阈值一定时间的时候系统会认为车位无人占用。



## 总结

### **项目特色与创新点**

1. 查询车位使用情况

   结合车锁及车锁上的地磁探测器来查询车锁使用情况，为预约车位提供判断标准。

2. 预约车位

   用户可根据车位查询情况预约车位，可随机匹配或自主预约车位。

​	当车主预约时即开始计算收费时间，同时将会为用户锁定车位，当车主抵达停车场车位时点击解锁车位即可停	车，当车主驾车离开停车场时则计费时间截止，系统会根据实际停车时间进行自动扣费。

3. 停车场定位及导航

   用户可输入地址或停车场名称，系统会推荐给用户最符合要求的几个停车场供车主选择。

   为解决车主在偌大的停车场无法立刻找到自己所订车位具体位置的问题，平台推出找车位功能。车主可在“订单”中查询已定订单，点击进入即可看到自己所预定的车位号，然后在其下放会生成从停车场简易地形图与停车场入口到预定车位的路线图。

4. 非预约停车

   若车主不使用平台功能，也可以在停车场内自主停车，不妨碍停车场正常运行。

5. 自动扣费

   平台还可以为车主提供自动扣费功能，车主可通过绑定微信或银行卡进行支付，系统将根据车主停车计费时间进行计算，在车主离场时自动扣费，省去车主扫码支付的时间，提高便利性。





### 附录

| 团队成员姓名 |        邮箱         |          分工          |
| :----------: | :-----------------: | :--------------------: |
|     徐俊     | aiy13145210@163.com |      前后端的搭建      |
|     尹强     |   yinqi13@163.com   | 文档的撰写、视频的剪辑 |
|    王一铭    | wym18932130@163.com |    建模，硬件的实现    |

微信小程序 `https://github.com/aiyb1314/smartPark.git`



